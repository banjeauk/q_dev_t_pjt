<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>동화 생성 중...</title>
    <style>
        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            margin: 0;
            padding: 0;
            background: radial-gradient(ellipse at center, #8B4513 0%, #654321 50%, #3E2723 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="paper" patternUnits="userSpaceOnUse" width="100" height="100"><rect width="100" height="100" fill="%23f4f1e8"/><circle cx="20" cy="20" r="1" fill="%23e8e0d0" opacity="0.3"/><circle cx="80" cy="60" r="1.5" fill="%23e8e0d0" opacity="0.2"/><circle cx="40" cy="80" r="0.8" fill="%23e8e0d0" opacity="0.4"/></pattern></defs><rect width="100" height="100" fill="url(%23paper)"/></svg>') repeat;
            opacity: 0.1;
            z-index: 0;
        }
        
        .book-container {
            perspective: 1000px;
            width: 350px;
            height: 450px;
            position: relative;
            z-index: 1;
        }
        
        .book {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }
        
        .page {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #faf8f3 0%, #f5f2e8 100%);
            border: 2px solid #8B4513;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            box-sizing: border-box;
            transform-origin: left center;
            backface-visibility: hidden;
        }
        
        .page::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            border: 1px solid #D4AF37;
            border-radius: 8px;
            opacity: 0.5;
        }
        
        .page1 {
            z-index: 3;
            animation: pageFlip1 2.5s infinite ease-in-out;
        }
        
        .page2 {
            z-index: 2;
            animation: pageFlip2 2.5s infinite ease-in-out 0.8s;
        }
        
        .page3 {
            z-index: 1;
            animation: pageFlip3 2.5s infinite ease-in-out 1.6s;
        }
        
        @keyframes pageFlip1 {
            0%, 30% {
                transform: rotateY(0deg);
            }
            60% {
                transform: rotateY(-180deg);
            }
            100% {
                transform: rotateY(-180deg);
            }
        }
        
        @keyframes pageFlip2 {
            0%, 30% {
                transform: rotateY(0deg);
            }
            60% {
                transform: rotateY(-180deg);
            }
            100% {
                transform: rotateY(-180deg);
            }
        }
        
        @keyframes pageFlip3 {
            0%, 30% {
                transform: rotateY(0deg);
            }
            60% {
                transform: rotateY(-180deg);
            }
            100% {
                transform: rotateY(-180deg);
            }
        }
        
        .loading-text {
            text-align: center;
            margin-top: 40px;
            color: #F5DEB3;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 1;
            position: relative;
        }
        
        .loading-text h2 {
            font-size: 28px;
            margin-bottom: 15px;
            animation: pulse 2s infinite;
            font-family: 'Georgia', serif;
            font-weight: bold;
            color: #FFD700;
        }
        
        .loading-text p {
            font-size: 18px;
            opacity: 0.9;
            font-style: italic;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }
        
        .page-content {
            text-align: center;
            color: #8B4513;
            z-index: 2;
            position: relative;
        }
        
        .page-content h3 {
            font-size: 22px;
            margin-bottom: 20px;
            color: #B8860B;
            font-family: 'Georgia', serif;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .page-content .icon {
            font-size: 64px;
            margin-bottom: 20px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
        }
        
        .page-content p {
            font-size: 16px;
            line-height: 1.6;
            font-style: italic;
            color: #654321;
        }
        
        .dots {
            display: inline-block;
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="book-container">
        <div class="book">
            <div class="page page1">
                <div class="page-content">
                    <div class="icon">📖</div>
                    <h3>동화 생성 중</h3>
                    <p>AI가 멋진 이야기를<br>만들고 있어요</p>
                </div>
            </div>
            <div class="page page2">
                <div class="page-content">
                    <div class="icon">🎨</div>
                    <h3>이미지 생성 중</h3>
                    <p>아름다운 그림을<br>그리고 있어요</p>
                </div>
            </div>
            <div class="page page3">
                <div class="page-content">
                    <div class="icon">✨</div>
                    <h3>마무리 중</h3>
                    <p>곧 완성됩니다!</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="loading-text">
        <h2>마법의 동화책이 만들어지고 있어요<span class="dots"></span></h2>
        <p>잠시만 기다려주세요</p>
    </div>
    
    <script>
        // 2초마다 동화 완성 상태 확인
        function checkStoryComplete() {
            fetch('/story/' + [[${storyId}]] + '/complete')
                .then(response => {
                    if (response.redirected && response.url.includes('/loading')) {
                        // 아직 완성되지 않음, 2초 후 다시 확인
                        setTimeout(checkStoryComplete, 2000);
                    } else {
                        // 완성됨, complete 페이지로 이동
                        window.location.href = '/story/' + [[${storyId}]] + '/complete';
                    }
                })
                .catch(error => {
                    console.error('Error checking story completion:', error);
                    // 오류 발생 시 5초 후 다시 시도
                    setTimeout(checkStoryComplete, 5000);
                });
        }
        
        // 3초 후부터 확인 시작
        setTimeout(checkStoryComplete, 3000);
    </script>
</body>
</html>